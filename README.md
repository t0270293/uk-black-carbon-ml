# Improving Temporal and Spatial Coverage of UK Black Carbon Measurements

### Applying a Machine Learning Approach (Paper 1)

This repository contains the R code and data processing pipeline for this article. It uses a machine learning approach (Stacked Ensemble of Random Forest and XGBoost) to estimate missing Black Carbon (BC) data at Urban and Rural Background sites across the UK between 2009 and 2020.

## üìÇ Repository Structure

The project is organized into three main folders:

    uk-black-carbon-ml/
    ‚îú‚îÄ‚îÄ data/                    # Input data files (CSV)
    ‚îú‚îÄ‚îÄ scripts/                 # R scripts for analysis (numbered 00-05)
    ‚îî‚îÄ‚îÄ plots/                   # Output figures generated by the analysis

## üöÄ How to Run the Analysis

The scripts are numbered sequentially. Please run them in the following order:

### 1. Data Acquisition
* **`00_Download_NAEI_grid_data.R`**: Downloads gridded emission data (Black Carbon and PM2.5) from the UK National Atmospheric Emissions Inventory (NAEI).
* **`01a_Download_Data&DataSites_UB.R`**: Downloads air quality monitoring data for **Urban Background (UB)** sites from the AURN network.
* **`01b_Download_Data&DataSites_RB.R`**: Downloads air quality monitoring data for **Rural Background (RB)** sites.

### 2. Weather Data Processing
* **`02_Process_Weather_Data.R`**: Extracts meteorological variables (temperature, wind, boundary layer height, etc.) from NetCDF files for the years 2009‚Äì2020.
    * **‚ö†Ô∏è Important Note:** The raw weather files (`.nc` format, ~600MB each) are **not included** in this repository due to GitHub file size limits.
    * To run this script, you must obtain the yearly weather files (e.g., `weather_2009.nc`) and place them in a local folder named `data/weather_raw/`.

### 3. Feature Selection
* **`03a_FeatureSelection_bc_UB.R`**: Performs Recursive Feature Elimination (RFE) to identify the most important predictors for Black Carbon at Urban sites.
* **`03b_FeatureSelection_bc_RB.R`**: Performs the same RFE process for Rural sites.

### 4. Model Training & Estimation
* **`04a_BC_estimation_UB.R`**: Trains the Stacked Ensemble model (Random Forest + XGBoost) for Urban sites and generates gap-filled BC estimates.
* **`04b_BC_estimation_RB.R`**: Trains the equivalent model for Rural sites.
* **`04c_Compare_Methods.R`**: Compares the performance of the Machine Learning approach against baseline methods (Linear Regression and Inverse Distance Weighting).

### 5. Visualization
* **`05_ploting_timeSeries_UBRB.R`**: Generates the final time-series plots, BC/PM ratio analysis, and seasonal trends presented in the paper.

## üì¶ Requirements

All analysis was performed using **R**. The key packages required are:

* `tidyverse` (Data manipulation and plotting)
* `h2o` (Machine Learning models)
* `openair` (Air quality specific analysis)
* `saqgetr` (AURN data download)
* `raster` / `ncdf4` (Weather data processing)

## üìÑ Data Availability

* **Air Quality Data:** Publicly available from the UK [Automatic Urban and Rural Network (AURN)](https://uk-air.defra.gov.uk/).
* **Emissions Data:** Available from the [NAEI](https://naei.beis.gov.uk/).
* **Weather Data:** ERA5 reanalysis data was used for meteorological variables.

---
Air Quality Data: Publicly available from the UK Automatic Urban and Rural Network (AURN).

Emissions Data: Available from the NAEI.

Weather Data: ERA5 reanalysis data was used for meteorological variables.


Author: I S Wong
